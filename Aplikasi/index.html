<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SnapCut</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
html, body {
    transform: translate3d(0, 0, 0);
    will-change: transform;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

* {
    backface-visibility: hidden;
    perspective: 1000px;
}

header {
    transform: translate3d(0, 0, 0);
    will-change: transform, backdrop-filter;
    -webkit-backdrop-filter: blur(10px);
    isolation: isolate;
}

@keyframes pulse-badge {
    0%, 100% { 
        transform: translate3d(0, 0, 0) scale(1); 
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4);
    }
    50% { 
        transform: translate3d(0, 0, 0) scale(1.02); 
        box-shadow: 0 0 0 4px rgba(34, 197, 94, 0);
    }
}

@keyframes pulse-stage {
    0%, 100% { 
        transform: translate3d(0, 0, 0) scale(1); 
        opacity: 1; 
    }
    50% { 
        transform: translate3d(0, 0, 0) scale(1.02); 
        opacity: 0.7; 
    }
}

@keyframes shimmer {
    0% { 
        transform: translate3d(-100%, 0, 0); 
    }
    100% { 
        transform: translate3d(100%, 0, 0); 
    }
}

@keyframes pulse-dot {
    0%, 100% { 
        transform: translate3d(0, 0, 0) scale(1); 
        opacity: 1; 
    }
    50% { 
        transform: translate3d(0, 0, 0) scale(1.5); 
        opacity: 0.7; 
    }
}

@keyframes pulse {
    0%, 100% { 
        transform: translate3d(0, 0, 0) scale(1); 
        opacity: 0.5; 
    }
    50% { 
        transform: translate3d(0, 0, 0) scale(1.1); 
        opacity: 0.8; 
    }
}

@keyframes slideIn {
    from {
        transform: translate3d(100%, 0, 0);
        opacity: 0;
    }
    to {
        transform: translate3d(0, 0, 0);
        opacity: 1;
    }
}

@keyframes ai-spin {
    0% { 
        transform: translate3d(0, 0, 0) rotate(0deg); 
    }
    100% { 
        transform: translate3d(0, 0, 0) rotate(360deg); 
    }
}

.gpu-badge.processing,
.ai-progress-stage.active,
.ai-progress-dot,
.canvas-content::before,
.ai-loader-circle {
    transform: translate3d(0, 0, 0);
    will-change: transform, opacity;
    backface-visibility: hidden;
}

.logo-icon,
.upload-area,
.format-btn,
.download-btn,
.upload-icon,
.placeholder-icon {
    transform: translate3d(0, 0, 0);
    will-change: transform, background, border-color;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

img, canvas, video {
    transform: translate3d(0, 0, 0);
    will-change: transform;
    image-rendering: -webkit-optimize-contrast;
    backface-visibility: hidden;
}

.sidebar {
    -webkit-overflow-scrolling: touch;
    scroll-behavior: smooth;
    transform: translate3d(0, 0, 0);
}

.slider,
.slider::-webkit-slider-thumb {
    transform: translate3d(0, 0, 0);
    will-change: transform;
}

.performance-mode {
    animation-duration: 0.5s !important;
    transition-duration: 0.1s !important;
}

.heavy-workload-mode {
    animation-play-state: paused !important;
    transition: none !important;
}

.heavy-workload-mode .ai-processing-animation * {
    animation-play-state: running !important;
}

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', sans-serif;
    background: #000000;
    color: #e8e8e8;
    overflow-x: hidden;
}

/* GPU-accelerated scroll */
body::-webkit-scrollbar {
    width: 8px;
    background: transparent;
}

body::-webkit-scrollbar-track {
    background: rgba(255, 255, 255, 0.02);
    border-radius: 4px;
}

body::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 4px;
}

body::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.15);
}

header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 2rem 4rem;
    background: rgba(255, 255, 255, 0.02);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(10px);
    position: sticky;
    top: 0;
    z-index: 100;
}

.logo {
    display: flex;
    align-items: center;
    gap: 1.2rem;
    font-size: 2.2rem;
    font-weight: 700;
    color: #fff;
    letter-spacing: -1px;
}

.logo-icon {
    width: 48px;
    height: 48px;
    background: rgba(255, 255, 255, 0.06);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.4rem;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.logo-icon:hover {
    background: rgba(255, 255, 255, 0.08);
    transform: rotate(-5deg) scale(1.05);
}

.header-right {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.gpu-badge {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    border: 1px solid rgba(34, 197, 94, 0.2);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.gpu-badge i {
    font-size: 0.85rem;
}

.gpu-badge.processing {
    animation: pulse-badge 2s ease-in-out infinite;
}

.beta-badge {
    background: rgba(255, 255, 255, 0.04);
    color: #888;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    font-size: 0.65rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.container {
    display: flex;
    height: calc(100vh - 97px);
    position: relative;
}

.sidebar {
    width: 360px;
    background: rgba(255, 255, 255, 0.02);
    border-right: 1px solid rgba(255, 255, 255, 0.06);
    padding: 3rem 2.5rem;
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
    overflow-y: auto;
}

.sidebar::-webkit-scrollbar {
    width: 5px;
}

.sidebar::-webkit-scrollbar-track {
    background: transparent;
}

.sidebar::-webkit-scrollbar-thumb {
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
}

.sidebar::-webkit-scrollbar-thumb:hover {
    background: rgba(255, 255, 255, 0.15);
}

.upload-section {
    position: relative;
}

.upload-area {
    width: 100%;
    padding: 3rem 2rem;
    background: rgba(255, 255, 255, 0.03);
    border: 2px dashed rgba(255, 255, 255, 0.15);
    border-radius: 16px;
    cursor: pointer;
    text-align: center;
}

.upload-area:hover {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(255, 255, 255, 0.25);
    transform: translateY(-2px);
}

.upload-area.drag-over {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.35);
    box-shadow: 0 8px 32px rgba(255, 255, 255, 0.1);
}

.upload-icon {
    width: 70px;
    height: 70px;
    margin: 0 auto 1.5rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    color: #999;
}

.upload-area:hover .upload-icon {
    background: rgba(255, 255, 255, 0.08);
    transform: scale(1.1);
}

.upload-text h3 {
    font-size: 1.1rem;
    font-weight: 600;
    color: #e8e8e8;
    margin-bottom: 0.5rem;
    letter-spacing: -0.3px;
}

.upload-text p {
    font-size: 0.85rem;
    color: #666;
    line-height: 1.6;
}

.divider {
    display: flex;
    align-items: center;
    gap: 1rem;
    color: #444;
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-weight: 600;
}

.divider::before,
.divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(255, 255, 255, 0.06);
}

.format-section {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 16px;
    padding: 2rem;
}

.section-title {
    color: #888;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.8px;
    margin-bottom: 1.5rem;
}

.format-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0.7rem;
}

.format-btn {
    padding: 1rem;
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.08);
    border-radius: 10px;
    color: #888;
    font-size: 0.95rem;
    font-weight: 700;
    cursor: pointer;
    text-align: center;
    letter-spacing: 0.5px;
}

.format-btn:hover {
    background: rgba(255, 255, 255, 0.04);
    border-color: rgba(255, 255, 255, 0.15);
    color: #ccc;
    transform: translateY(-2px);
}

.format-btn.active {
    background: rgba(255, 255, 255, 0.1);
    border-color: rgba(255, 255, 255, 0.25);
    color: #fff;
    box-shadow: 0 4px 20px rgba(255, 255, 255, 0.05);
    transform: translateY(-1px);
}

.ai-progress-indicator {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 16px;
    padding: 1.5rem;
    display: none;
}

.ai-progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 1.5rem;
}

.ai-progress-title {
    color: #888;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1.8px;
}

.ai-progress-stage {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
    padding: 0.4rem 0.8rem;
    border-radius: 6px;
    font-size: 0.7rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    border: 1px solid rgba(34, 197, 94, 0.2);
}

.ai-progress-stage.active {
    animation: pulse-stage 1.5s ease-in-out infinite;
}

.ai-progress-bar {
    width: 100%;
    height: 8px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 1rem;
}

.ai-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #3b82f6, #8b5cf6, #22c55e);
    border-radius: 4px;
    width: 0%;
    transition: width 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
    position: relative;
}

.ai-progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.4),
        transparent
    );
    animation: shimmer 2s infinite;
}

.ai-progress-details {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.5rem;
}

.ai-progress-percentage {
    font-size: 1.2rem;
    font-weight: 700;
    color: #fff;
}

.ai-progress-speed {
    font-size: 0.8rem;
    color: #888;
    font-family: 'Courier New', monospace;
}

.ai-progress-message {
    font-size: 0.85rem;
    color: #aaa;
    height: 40px;
    display: flex;
    align-items: center;
}

.ai-progress-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.75rem;
    color: #888;
    margin-top: 1rem;
}

.ai-progress-dot {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: #22c55e;
    animation: pulse-dot 1s ease-in-out infinite;
}

.slider-section {
    background: rgba(255, 255, 255, 0.02);
    border: 1px solid rgba(255, 255, 255, 0.06);
    border-radius: 16px;
    padding: 2rem;
    display: none;
}

.slider-container {
    margin: 1.5rem 0 0;
}

.slider-labels {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.75rem;
    font-size: 0.85rem;
    color: #888;
}

.slider {
    width: 100%;
    height: 6px;
    -webkit-appearance: none;
    appearance: none;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    outline: none;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.9);
    cursor: pointer;
    border: 2px solid #000;
}

.slider::-webkit-slider-thumb:hover {
    transform: scale(1.2);
}

.slider::-moz-range-thumb {
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.9);
    cursor: pointer;
    border: 2px solid #000;
}

.download-section {
    margin-top: auto;
}

.download-btn {
    width: 100%;
    padding: 1.3rem;
    background: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 14px;
    color: #999;
    font-size: 1.05rem;
    font-weight: 600;
    cursor: not-allowed;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    letter-spacing: 0.3px;
    position: relative;
    overflow: hidden;
}

.download-btn::before {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0%;
    height: 3px;
    background: linear-gradient(90deg, #4CAF50, #2196F3);
    transition: width 0.3s ease;
}

.download-btn.processing::before {
    width: var(--progress, 0%);
}

.btn-main-text {
    display: flex;
    align-items: center;
    gap: 0.8rem;
}

.btn-subtitle {
    font-size: 0.72rem;
    color: #666;
    font-weight: 500;
    letter-spacing: 0.3px;
    line-height: 1.3;
}

.download-btn.active {
    background: rgba(255, 255, 255, 0.08);
    border-color: rgba(255, 255, 255, 0.2);
    color: #e8e8e8;
    cursor: pointer;
}

.download-btn.active:hover {
    background: rgba(255, 255, 255, 0.12);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(255, 255, 255, 0.1);
}

.canvas-area {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 4rem;
    position: relative;
    background: radial-gradient(ellipse at center, rgba(255, 255, 255, 0.02) 0%, transparent 70%);
}

.canvas-content {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 20px;
    background: 
        linear-gradient(45deg, rgba(255, 255, 255, 0.015) 25%, transparent 25%),
        linear-gradient(-45deg, rgba(255, 255, 255, 0.015) 25%, transparent 25%),
        linear-gradient(45deg, transparent 75%, rgba(255, 255, 255, 0.015) 75%),
        linear-gradient(-45deg, transparent 75%, rgba(255, 255, 255, 0.015) 75%);
    background-size: 40px 40px;
    background-position: 0 0, 0 20px, 20px -20px, -20px 0px;
    border: 1px solid rgba(255, 255, 255, 0.04);
    position: relative;
    overflow: hidden;
}

.canvas-content::before {
    content: '';
    position: absolute;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    background: radial-gradient(circle, rgba(255, 255, 255, 0.03) 0%, transparent 70%);
    animation: pulse 8s ease-in-out infinite;
}

.comparison-container {
    position: relative;
    width: 90%;
    height: 90%;
    display: none;
    z-index: 5;
}

.comparison-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    border-radius: 16px;
    box-shadow: 0 30px 80px rgba(0, 0, 0, 0.6);
}

.image-before, .image-after {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: contain;
    background: #000;
}

.image-after {
    clip-path: inset(0 50% 0 0);
}

.comparison-slider-handle {
    position: absolute;
    top: 0;
    left: 50%;
    width: 4px;
    height: 100%;
    background: rgba(255, 255, 255, 0.9);
    cursor: ew-resize;
    transform: translateX(-50%);
    z-index: 10;
}

.comparison-slider-handle::before {
    content: '\f337';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    background: rgba(255, 255, 255, 0.9);
    border-radius: 50%;
    border: 3px solid #000;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Font Awesome 6 Free';
    font-weight: 900;
    font-size: 16px;
    color: #000;
    line-height: 40px;
    text-align: center;
}

.comparison-label {
    position: absolute;
    top: 20px;
    padding: 8px 16px;
    background: rgba(0, 0, 0, 0.7);
    color: white;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    z-index: 5;
    backdrop-filter: blur(10px);
}

.before-label {
    left: 20px;
}

.after-label {
    right: 20px;
}

.placeholder {
    text-align: center;
    color: #555;
    position: relative;
    z-index: 1;
}

.placeholder-icon {
    width: 140px;
    height: 140px;
    margin: 0 auto 2.5rem;
    background: rgba(255, 255, 255, 0.02);
    border-radius: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 2px dashed rgba(255, 255, 255, 0.12);
}

.placeholder-icon i {
    font-size: 4rem;
    color: #333;
}

.placeholder:hover .placeholder-icon {
    background: rgba(255, 255, 255, 0.03);
    border-color: rgba(255, 255, 255, 0.18);
    transform: scale(1.05);
}

.placeholder:hover .placeholder-icon i {
    color: #555;
}

.placeholder h2 {
    font-size: 2.2rem;
    margin-bottom: 1rem;
    color: #ccc;
    font-weight: 600;
    letter-spacing: -1px;
}

.placeholder p {
    font-size: 1rem;
    line-height: 1.8;
    color: #555;
}

.progress-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 3px;
    background: rgba(255, 255, 255, 0.05);
    z-index: 1000;
    display: none;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #4CAF50, #2196F3);
    width: 0%;
    transition: width 0.3s ease;
}

.notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1rem 1.5rem;
    background: rgba(0, 0, 0, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 12px;
    color: white;
    font-weight: 500;
    z-index: 1000;
    display: none;
    backdrop-filter: blur(10px);
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    animation: slideIn 0.3s ease;
}

.notification.success {
    border-left: 4px solid #4CAF50;
}

.notification.error {
    border-left: 4px solid #F44336;
}

.notification.info {
    border-left: 4px solid #2196F3;
}

.notification.ai {
    border-left: 4px solid #8b5cf6;
}

.ai-processing-animation {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.85);
    backdrop-filter: blur(20px);
    z-index: 2000;
    display: none;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 3rem;
}

.ai-loader {
    width: 200px;
    height: 200px;
    position: relative;
}

.ai-loader-circle {
    position: absolute;
    width: 100%;
    height: 100%;
    border-radius: 50%;
    border: 3px solid transparent;
    animation: ai-spin 2s linear infinite;
}

.ai-loader-circle:nth-child(1) {
    border-top-color: #3b82f6;
    animation-duration: 1.5s;
}

.ai-loader-circle:nth-child(2) {
    border-right-color: #8b5cf6;
    animation-duration: 2s;
}

.ai-loader-circle:nth-child(3) {
    border-bottom-color: #22c55e;
    animation-duration: 2.5s;
}

.ai-processing-text {
    text-align: center;
    max-width: 600px;
}

.ai-processing-text h3 {
    font-size: 2rem;
    margin-bottom: 1.5rem;
    color: #fff;
    font-weight: 600;
    letter-spacing: -0.5px;
}

.ai-processing-stage {
    display: inline-block;
    padding: 0.8rem 1.5rem;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    font-size: 1.1rem;
    color: #aaa;
    margin-bottom: 2rem;
    border: 1px solid rgba(255, 255, 255, 0.15);
}

.ai-processing-message {
    font-size: 1rem;
    color: #888;
    line-height: 1.6;
}

.ai-resource-info {
    position: absolute;
    bottom: 3rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 2rem;
}

.ai-resource-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: #666;
    font-size: 0.9rem;
}

.ai-resource-item i {
    font-size: 1rem;
}

@media (max-width: 968px) {
    header {
        padding: 1.5rem 2rem;
    }
    
    .container {
        flex-direction: column;
        height: auto;
    }
    
    .sidebar {
        width: 100%;
        border-right: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    }
    
    .canvas-area {
        min-height: 500px;
        padding: 2rem;
    }
    
    .gpu-badge {
        display: none;
    }
    
    .ai-processing-animation {
        padding: 2rem;
    }
    
    .ai-loader {
        width: 150px;
        height: 150px;
    }
    
    .ai-processing-text h3 {
        font-size: 1.5rem;
    }
}

@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    body {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    
    .canvas-content {
        background-size: 80px 80px;
    }
}
    </style>
</head>
<body>
    <div class="progress-container" id="progressContainer">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    
    <div class="ai-processing-animation" id="aiProcessingAnimation">
        <div class="ai-loader">
            <div class="ai-loader-circle"></div>
            <div class="ai-loader-circle"></div>
            <div class="ai-loader-circle"></div>
        </div>
        <div class="ai-processing-text">
            <h3 id="aiProcessingTitle">Ai sedang memproses</h3>
            <div class="ai-processing-stage" id="aiProcessingStage">Mulai...</div>
            <div class="ai-processing-message" id="aiProcessingMessage">
                Ai sedang memproses gambar, tunggu bentar ya...
            </div>
        </div>
        <div class="ai-resource-info">
            <div class="ai-resource-item">
                <i class="fas fa-microchip"></i>
                <span>CPU</span>
            </div>
            <div class="ai-resource-item">
                <i class="fas fa-clock"></i>
                <span id="aiProcessingTimer">00:00</span>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification"></div>
    
    <header>
        <div class="logo">
            <div class="logo-icon">
                <img src="Logo.ico" alt="SnapCut Logo" width="50" height="50">
            </div>
            <span>SnapCut</span>
        </div>
            <span class="beta-badge">v 1.0</span>
        </div>
    </header>
    
    <div class="container">
        <aside class="sidebar">
            <div class="upload-section">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">
                        <i class="fas fa-cloud-upload-alt"></i>
                    </div>
                    <div class="upload-text">
                        <h3>Taro gambar mu disini</h3>
                        <p>atau pencet klik untuk mencari gambar<br>PNG, JPG, WEBP ‚Ä¢ Maksimal sampai 10MB</p>
                    </div>
                </div>
            </div>
            
            <div class="ai-progress-indicator" id="aiProgressIndicator">
                <div class="ai-progress-header">
                    <div class="ai-progress-title">Proses AI</div>
                    <div class="ai-progress-stage" id="aiProgressStage">Loading</div>
                </div>
                <div class="ai-progress-bar">
                    <div class="ai-progress-fill" id="aiProgressFill"></div>
                </div>
                <div class="ai-progress-details">
                    <div class="ai-progress-percentage" id="aiProgressPercentage">0%</div>
                    <div class="ai-progress-speed" id="aiProgressSpeed">-</div>
                </div>
                <div class="ai-progress-message" id="aiProgressMessage">
                    Menunggu gambar untuk diproses...
                </div>
                <div class="ai-progress-status" id="aiProgressStatus">
                    <div class="ai-progress-dot"></div>
                    <span>AI model ready</span>
                </div>
            </div>
            
            <div class="divider">Format Hasil</div>
            
            <div class="format-section">
                <div class="section-title">Macam Macam Format</div>
                <div class="format-grid">
                    <button class="format-btn active" data-format="png">PNG</button>
                    <button class="format-btn" data-format="jpg">JPG</button>
                    <button class="format-btn" data-format="webp">WEBP</button>
                </div>
            </div>
            
            <div class="slider-section" id="sliderSection">
                <div class="section-title">Before/After Comparison</div>
                <div class="slider-container">
                    <div class="slider-labels">
                        <span>Sesudah</span>
                        <span>Sebelum</span>
                    </div>
                    <input type="range" min="0" max="100" value="50" class="slider" id="comparisonSlider">
                </div>
            </div>
            
            <div class="download-section">
                <button class="download-btn" id="downloadBtn">
                    <div class="btn-main-text">
                        <i class="fas fa-download"></i>
                        <span id="btnMainText">Download Hasil</span>
                    </div>
                    <div class="btn-subtitle" id="btnSubtitle"></div>
                </button>
            </div>
        </aside>
        
        <main class="canvas-area">
            <div class="canvas-content">
                <div class="comparison-container" id="comparisonContainer">
                    <div class="comparison-wrapper">
                        <img class="image-before" id="imageBefore" alt="Before">
                        <img class="image-after" id="imageAfter" alt="After">
                        <div class="comparison-slider-handle" id="comparisonSliderHandle"></div>
                        <div class="comparison-label before-label">Sesudah</div>
                        <div class="comparison-label after-label">Sebelum</div>
                    </div>
                </div>
                
                <div class="placeholder" id="placeholder">
                    <div class="placeholder-icon">
                        <i class="fas fa-images"></i>
                    </div>
                    <h2>Siap Memproses</h2>
                    <p>Upload gambar untuk memulai proses penghapusan background gambar<br>Powered by BiRefNet AI Model (213 mb) ‚Ä¢ CPU only</p>
                </div>
            </div>
        </main>
    </div>

<script>
console.log('üöÄ SnapCut Starting...');

let processingStartTime = null;
let processingTimerInterval = null;

function startProcessingTimer() {
    if (processingTimerInterval) {
        clearInterval(processingTimerInterval);
        processingTimerInterval = null;
    }
    
    processingStartTime = null;
    
    processingStartTime = Date.now();
    console.log('‚è±Ô∏è Timer dimulai:', new Date().toLocaleTimeString());
    
    updateTimerDisplay();
    
    processingTimerInterval = setInterval(() => {
        updateTimerDisplay();
    }, 1000);
}

function updateTimerDisplay() {
    if (!processingStartTime) return;
    
    const elapsedSeconds = Math.floor((Date.now() - processingStartTime) / 1000);
    const minutes = Math.floor(elapsedSeconds / 60).toString().padStart(2, '0');
    const seconds = (elapsedSeconds % 60).toString().padStart(2, '0');
    const timeString = `${minutes}:${seconds}`;
    
    const btnSubtitle = document.getElementById('btnSubtitle');
    if (btnSubtitle) {
        btnSubtitle.textContent = `Sedang diproses... (${timeString})`;
    }
    
    const aiTimerElement = document.getElementById('aiProcessingTimer');
    if (aiTimerElement) {
        aiTimerElement.textContent = timeString;
    }
}

function stopProcessingTimer() {
    let processingTime = 0;
    

    if (processingTimerInterval) {
        clearInterval(processingTimerInterval);
        processingTimerInterval = null;
    }
    
    if (processingStartTime) {
        processingTime = Math.floor((Date.now() - processingStartTime) / 1000);
        console.log(`‚è±Ô∏è Timer dihentikan: ${processingTime} detik`);
        processingStartTime = null;
    }
    
    return processingTime;
}

function showProcessingTimeNotification(processingTime) {
    if (!processingTime || processingTime <= 0) {
        showNotification('‚úÖ Proses selesai!', 'success');
        return;
    }
    
    const minutes = Math.floor(processingTime / 60);
    const seconds = processingTime % 60;
    
    let timeText;
    if (minutes > 0) {
        timeText = `${minutes} menit ${seconds} detik`;
    } else {
        timeText = `${seconds} detik`;
    }
    
    showNotification(`‚úÖ Gambar selesai diproses dalam ${timeText}!`, 'success');
}

function showSplashScreen() {
    const existingSplash = document.getElementById('splashScreen');
    if (existingSplash) {
        existingSplash.remove();
    }
    
    const splashScreen = document.createElement('div');
    splashScreen.id = 'splashScreen';
    splashScreen.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: #000;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        opacity: 1;
        transition: opacity 0.5s ease;
    `;
    
    splashScreen.innerHTML = `
        <div style="text-align: center; margin-bottom: 3rem;">
            <div style="width: 100px; height: 100px; margin: 0 auto 2rem; background: rgba(255,255,255,0.05); border-radius: 20px; display: flex; align-items: center; justify-content: center; border: 2px solid rgba(255,255,255,0.1);">
                <img src="Logo.ico" alt="SnapCut Logo" width="100" height="100">
            </div>
            <h1 style="font-size: 3rem; font-weight: 700; color: #fff; margin-bottom: 1rem; letter-spacing: -1px;">SnapCut</h1>
            <p style="color: #888; font-size: 1rem; max-width: 400px; line-height: 1.6;">AI Background Remover</p>
        </div>
        <div style="width: 200px; height: 4px; background: rgba(255,255,255,0.1); border-radius: 2px; overflow: hidden;">
            <div id="splashProgress" style="width: 0%; height: 100%; background: linear-gradient(90deg, #3b82f6, #8b5cf6); transition: width 0.3s ease;"></div>
        </div>
        <div style="margin-top: 2rem; color: #666; font-size: 0.9rem;">
            <span id="splashStatus">Memuat aplikasi...</span>
        </div>
    `;
    
    document.body.appendChild(splashScreen);
    
    let progress = 0;
    const progressBar = document.getElementById('splashProgress');
    const splashStatus = document.getElementById('splashStatus');
    
    const loadingInterval = setInterval(() => {
        progress += Math.random() * 15 + 5;
        if (progress > 100) progress = 100;
        
        progressBar.style.width = `${progress}%`;
        
        if (progress < 30) {
            splashStatus.textContent = "Memuat komponen UI...";
        } else if (progress < 60) {
            splashStatus.textContent = "Menginisialisasi AI model...";
        } else if (progress < 90) {
            splashStatus.textContent = "Menyiapkan sistem...";
        } else {
            splashStatus.textContent = "Hampir selesai...";
        }
        
        if (progress >= 100) {
            clearInterval(loadingInterval);
            
            setTimeout(() => {
                splashScreen.style.opacity = '0';
                setTimeout(() => {
                    splashScreen.remove();
                    showNotification('Aplikasi SnapCut siap digunakan!', 'info');
                }, 500);
            }, 500);
        }
    }, 200);
}

const uploadArea = document.getElementById('uploadArea');
const placeholder = document.getElementById('placeholder');
const downloadBtn = document.getElementById('downloadBtn');
const btnMainText = document.getElementById('btnMainText');
const btnSubtitle = document.getElementById('btnSubtitle');
const progressContainer = document.getElementById('progressContainer');
const progressBar = document.getElementById('progressBar');
const notification = document.getElementById('notification');
const sliderSection = document.getElementById('sliderSection');
const comparisonContainer = document.getElementById('comparisonContainer');
const imageBefore = document.getElementById('imageBefore');
const imageAfter = document.getElementById('imageAfter');
const comparisonSlider = document.getElementById('comparisonSlider');
const comparisonSliderHandle = document.getElementById('comparisonSliderHandle');
const aiProgressIndicator = document.getElementById('aiProgressIndicator');
const aiProgressFill = document.getElementById('aiProgressFill');
const aiProgressPercentage = document.getElementById('aiProgressPercentage');
const aiProgressSpeed = document.getElementById('aiProgressSpeed');
const aiProgressMessage = document.getElementById('aiProgressMessage');
const aiProgressStage = document.getElementById('aiProgressStage');
const aiProgressStatus = document.getElementById('aiProgressStatus');
const aiProcessingAnimation = document.getElementById('aiProcessingAnimation');
const aiProcessingTitle = document.getElementById('aiProcessingTitle');
const aiProcessingStage = document.getElementById('aiProcessingStage');
const aiProcessingMessage = document.getElementById('aiProcessingMessage');
const aiProcessingTimer = document.getElementById('aiProcessingTimer');

let processedImageBuffer = null;
let selectedFormat = 'png';
let originalImageUrl = null;
let processedImageUrl = null;
let isDraggingSlider = false;
let isProcessing = false;
let currentNotificationTimeout = null;

const aiStages = {
    'init': {
        title: 'Memulai Sistem',
        message: 'Menginisialisasi AI model dan sistem...',
        color: '#3b82f6',
        duration: 500
    },
    'loading_model': {
        title: 'Loading AI Model',
        message: 'Memuat AI model ke memory...',
        color: '#8b5cf6',
        duration: 1500
    },
    'preprocessing': {
        title: 'Preprocessing Gambar',
        message: 'Meresize dan menormalisasi gambar input...',
        color: '#f59e0b',
        duration: 800
    },
    'ai_inference': {
        title: 'AI Sedang Bekerja',
        message: 'AI model sedang memproses gambar. Ini mungkin memakan waktu beberapa detik...',
        color: '#22c55e',
        duration: 3000
    },
    'postprocessing': {
        title: 'Postprocessing',
        message: 'Membersihkan edges dan smoothing hasil...',
        color: '#06b6d4',
        duration: 1000
    },
    'complete': {
        title: 'Proses Selesai!',
        message: 'Background berhasil dihapus!',
        color: '#10b981',
        duration: 0
    },
    'error': {
        title: 'Terjadi Error',
        message: 'Ada masalah dalam pemrosesan.',
        color: '#ef4444',
        duration: 0
    }
};

function showNotification(message, type = 'info', duration = 3000) {
    if (currentNotificationTimeout) {
        clearTimeout(currentNotificationTimeout);
        currentNotificationTimeout = null;
    }
    
    notification.textContent = message;
    notification.className = `notification ${type}`;
    notification.style.display = 'block';
    
    if (duration > 0) {
        currentNotificationTimeout = setTimeout(() => {
            notification.style.display = 'none';
            currentNotificationTimeout = null;
        }, duration);
    }
}

function hideNotification() {
    if (currentNotificationTimeout) {
        clearTimeout(currentNotificationTimeout);
        currentNotificationTimeout = null;
    }
    notification.style.display = 'none';
}

function showProgress(show) {
    progressContainer.style.display = show ? 'block' : 'none';
    if (!show) progressBar.style.width = '0%';
}

function updateProgress(percentage) {
    progressBar.style.width = `${percentage}%`;
}

function updateAIProgress(progress) {
    const stage = aiStages[progress.stage] || aiStages['init'];
    
    aiProgressFill.style.width = `${progress.percentage}%`;
    aiProgressFill.style.background = `linear-gradient(90deg, #3b82f6, ${stage.color})`;
    aiProgressPercentage.textContent = `${progress.percentage}%`;
    
    aiProgressStage.textContent = progress.stage.toUpperCase();
    aiProgressStage.style.color = stage.color;
    aiProgressStage.style.borderColor = `${stage.color}40`;
    aiProgressStage.style.background = `${stage.color}15`;
    
    aiProgressMessage.textContent = progress.message || stage.message;

    if (processingStartTime) {
        const elapsed = Date.now() - processingStartTime;
        const speed = progress.percentage > 0 ? (elapsed / progress.percentage).toFixed(0) : 0;
        aiProgressSpeed.textContent = `${speed}ms/%`;
    }

    if (aiProcessingAnimation.style.display === 'flex') {
        aiProcessingTitle.textContent = stage.title;
        aiProcessingStage.textContent = progress.stage.toUpperCase();
        aiProcessingStage.style.color = stage.color;
        aiProcessingMessage.textContent = progress.message || stage.message;
    }

    downloadBtn.innerHTML = `
        <div class="btn-main-text">
            <i class="fas ${getStageIcon(progress.stage)}"></i>
            <span>${progress.percentage}% - ${stage.title}</span>
        </div>
        <div class="btn-subtitle">${progress.message || stage.message}</div>
    `;

    updateProgress(progress.percentage);
}

function getStageIcon(stage) {
    const icons = {
        'init': 'fa-cog fa-spin',
        'loading_model': 'fa-database fa-pulse',
        'preprocessing': 'fa-image fa-pulse',
        'ai_inference': 'fa-brain fa-spin',
        'postprocessing': 'fa-wand-magic-sparkles fa-pulse',
        'complete': 'fa-check-circle',
        'error': 'fa-exclamation-triangle'
    };
    return icons[stage] || 'fa-spinner fa-spin';
}

function showAIProcessingAnimation(show) {
    if (show) {
        aiProcessingAnimation.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        aiProcessingTimer.textContent = '00:00';
    } else {
        aiProcessingAnimation.style.display = 'none';
        document.body.style.overflow = '';
    }
}

function updateComparisonSlider(percentage) {
    comparisonSliderHandle.style.left = `${percentage}%`;
    imageAfter.style.clipPath = `inset(0 ${100 - percentage}% 0 0)`;
}

function initComparisonSlider() {
    comparisonSlider.value = 50;
    updateComparisonSlider(50);
    
    comparisonSlider.addEventListener('input', (e) => {
        updateComparisonSlider(parseFloat(e.target.value));
    });
    
    comparisonSliderHandle.addEventListener('mousedown', (e) => {
        e.preventDefault();
        isDraggingSlider = true;
        document.body.style.cursor = 'ew-resize';
    });
    
    document.addEventListener('mousemove', (e) => {
        if (!isDraggingSlider) return;
        
        const rect = comparisonContainer.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
        
        comparisonSlider.value = percentage;
        updateComparisonSlider(percentage);
    });
    
    document.addEventListener('mouseup', () => {
        isDraggingSlider = false;
        document.body.style.cursor = '';
    });
}

document.querySelectorAll('.format-btn').forEach(btn => {
    btn.addEventListener('click', function() {
        document.querySelectorAll('.format-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');
        selectedFormat = this.dataset.format;
        console.log('Selected format:', selectedFormat);
    });
});

uploadArea.addEventListener('click', async () => {
    if (isProcessing) {
        showNotification('‚è≥ Tunggu sebentar, sedang memproses...', 'info');
        return;
    }
    
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/png,image/jpeg,image/webp';
    fileInput.style.display = 'none';
    
    fileInput.onchange = async (e) => {
        const file = e.target.files[0];
        if (file) await handleFile(file);
        document.body.removeChild(fileInput);
    };
    
    document.body.appendChild(fileInput);
    fileInput.click();
});

async function handleFile(file) {
    if (isProcessing) return;
    
    try {
        isProcessing = true;
        hideNotification();
        
        aiProgressIndicator.style.display = 'block';
        showAIProcessingAnimation(true);
        
        startProcessingTimer();
        
        updateAIProgress({
            stage: 'init',
            percentage: 5,
            message: 'Memulai proses AI...'
        });
        
        if (!file.type.match('image/(png|jpeg|webp)')) {
            throw new Error('Format tidak didukung');
        }
        if (file.size > 10 * 1024 * 1024) {
            throw new Error('Ukuran file terlalu besar (max 10MB)');
        }
        
        showNotification(`üì∏ Memproses: ${file.name}`, 'ai', 0);
        
        updateAIProgress({
            stage: 'preprocessing',
            percentage: 15,
            message: 'Membaca file gambar...'
        });
        
        const arrayBuffer = await file.arrayBuffer();
        const buffer = new Uint8Array(arrayBuffer);
        
        updateAIProgress({
            stage: 'preprocessing',
            percentage: 25,
            message: 'File berhasil dibaca, memulai AI...'
        });
        
        await processImage(buffer, file.name);
        
        showProgress(false);
        isProcessing = false;
        
    } catch (error) {
        console.error('Error:', error);
        showNotification(`‚ùå ${error.message}`, 'error', 5000);
        
        updateAIProgress({
            stage: 'error',
            percentage: 100,
            message: error.message
        });

        setTimeout(() => {
            aiProgressIndicator.style.display = 'none';
            showAIProcessingAnimation(false);
            stopProcessingTimer();
        }, 3000);
        
        showProgress(false);
        isProcessing = false;
    }
}

uploadArea.addEventListener('dragover', (e) => {
    e.preventDefault();
    if (!isProcessing) uploadArea.classList.add('drag-over');
});

uploadArea.addEventListener('dragleave', () => {
    uploadArea.classList.remove('drag-over');
});

uploadArea.addEventListener('drop', async (e) => {
    e.preventDefault();
    uploadArea.classList.remove('drag-over');
    
    if (isProcessing) {
        showNotification('‚è≥ Tunggu sebentar, sedang memproses...', 'info');
        return;
    }
    
    const files = e.dataTransfer.files;
    if (files.length > 0) await handleFile(files[0]);
});

async function processImage(buffer, fileName) {
    try {
        console.log('üîß Starting background removal...');
        
        if (originalImageUrl) URL.revokeObjectURL(originalImageUrl);
        if (processedImageUrl) URL.revokeObjectURL(processedImageUrl);
        
        const originalBlob = new Blob([buffer], { type: 'image/png' });
        originalImageUrl = URL.createObjectURL(originalBlob);
        
        downloadBtn.classList.add('processing');
        downloadBtn.classList.remove('active');
        
        if (typeof window.bgRemoval === 'undefined') {
            throw new Error('Background Removal API tidak tersedia');
        }
        
        console.log('üìû Calling AI API...');
        
        updateAIProgress({
            stage: 'loading_model',
            percentage: 35,
            message: 'Memuat AI model ke memory...'
        });
        
        const result = await window.bgRemoval.removeBackground(buffer);
        
        console.log('üìä AI Response:', {
            success: result.success,
            aiUsed: result.aiUsed,
            error: result.error,
            hasImage: !!result.image,
            imageSize: result.image ? result.image.length + ' bytes' : 'none'
        });
        
        if (!result.success || !result.aiUsed || !result.image) {
            throw new Error(result.error || 'AI processing failed');
        }
        
        updateAIProgress({
            stage: 'ai_inference',
            percentage: 65,
            message: 'AI sedang memproses gambar...'
        });
        
        console.log('üñºÔ∏è Creating image from buffer...');
        const resultBlob = new Blob([result.image], { type: 'image/png' });
        processedImageUrl = URL.createObjectURL(resultBlob);
        
        console.log('üß™ Testing image load...');
        await testImageLoad(processedImageUrl);
        
        processedImageBuffer = result.image;
        
        updateAIProgress({
            stage: 'postprocessing',
            percentage: 85,
            message: 'Membersihkan edges dan smoothing hasil...'
        });
        
        updateAIProgress({
            stage: 'complete',
            percentage: 100,
            message: 'Background berhasil dihapus!'
        });
        
        showBeforeAfterComparison(originalImageUrl, processedImageUrl);
        
        setTimeout(() => {
            showAIProcessingAnimation(false);
            
            const currentTime = processingStartTime ? Math.floor((Date.now() - processingStartTime) / 1000) : 0;
            
            let timeText = '';
            if (currentTime > 0) {
                const minutes = Math.floor(currentTime / 60);
                const seconds = currentTime % 60;
                
                if (minutes > 0) {
                    timeText = `${minutes} menit ${seconds} detik`;
                } else {
                    timeText = `${seconds} detik`;
                }
            } else {
                timeText = 'beberapa detik';
            }
            
            downloadBtn.classList.remove('processing');
            downloadBtn.innerHTML = `
                <div class="btn-main-text">
                    <i class="fas fa-download"></i>
                    <span>Download Hasil</span>
                </div>
                <div class="btn-subtitle">Background berhasil dihapus dalam ${timeText} ‚ú®</div>
            `;
            downloadBtn.classList.add('active');
            
            showProgress(false);
            
            setTimeout(() => {
                aiProgressIndicator.style.display = 'none';
                const finalProcessingTime = stopProcessingTimer();
                showProcessingTimeNotification(finalProcessingTime);
            }, 2000);
            
        }, 1000);
        
    } catch (error) {
        console.error('‚ùå Process error:', error);
        showNotification(`‚ùå ${error.message}`, 'error', 5000);
        
        updateAIProgress({
            stage: 'error',
            percentage: 100,
            message: error.message
        });
        
        downloadBtn.classList.remove('processing');
        downloadBtn.innerHTML = `
            <div class="btn-main-text">
                <i class="fas fa-download"></i>
                <span>Download Hasil</span>
            </div>
            <div class="btn-subtitle"></div>
        `;
        downloadBtn.classList.remove('active');
        
        showProgress(false);
        showAIProcessingAnimation(false);
        
        setTimeout(() => {
            aiProgressIndicator.style.display = 'none';
            const errorProcessingTime = stopProcessingTimer();
            console.log(`‚è±Ô∏è Total waktu dengan error: ${errorProcessingTime} detik`);
        }, 3000);
        
        throw error;
    }
}

async function testImageLoad(url) {
    return new Promise((resolve, reject) => {
        console.log('üß™ Testing image URL...');
        
        const testImg = new Image();
        testImg.onload = () => {
            console.log('‚úÖ Image test passed, dimensions:', testImg.width, 'x', testImg.height);
            resolve();
        };
        
        testImg.onerror = (err) => {
            console.error('‚ùå Image test failed:', err);
            reject(new Error('Gambar hasil tidak valid atau corrupt'));
        };
        
        testImg.src = url;
        
        setTimeout(() => {
            if (!testImg.complete) {
                reject(new Error('Image load timeout'));
            }
        }, 10000);
    });
}

function showBeforeAfterComparison(beforeUrl, afterUrl) {
    const beforeImg = new Image();
    const afterImg = new Image();
    
    Promise.all([
        new Promise(resolve => {
            beforeImg.onload = resolve;
            beforeImg.src = beforeUrl;
        }),
        new Promise(resolve => {
            afterImg.onload = resolve;
            afterImg.src = afterUrl;
        })
    ]).then(() => {
        imageBefore.src = beforeUrl;
        imageAfter.src = afterUrl;
        
        placeholder.style.display = 'none';
        comparisonContainer.style.display = 'block';
        sliderSection.style.display = 'block';
        
        setTimeout(() => initComparisonSlider(), 100);
    }).catch(error => {
        console.error('‚ùå Comparison error:', error);
        showNotification('‚ùå Gagal menampilkan hasil', 'error');
    });
}

downloadBtn.addEventListener('click', async () => {
    if (isProcessing || !downloadBtn.classList.contains('active') || !processedImageBuffer) {
        return;
    }
    try {
        const blob = new Blob([processedImageBuffer], { type: 'image/png' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = `snapcut-${Date.now()}.${selectedFormat}`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        URL.revokeObjectURL(url);
        
        showNotification(`‚úÖ File disimpan: snapcut.${selectedFormat}`, 'success');
        
    } catch (error) {
        console.error('Save error:', error);
        showNotification('‚ùå Gagal menyimpan gambar', 'error');
    }
});

window.addEventListener('beforeunload', () => {
    if (window.bgRemoval && typeof window.bgRemoval.cleanup === 'function') {
        window.bgRemoval.cleanup();
    }
    
    if (originalImageUrl) {
        URL.revokeObjectURL(originalImageUrl);
    }
    if (processedImageUrl) {
        URL.revokeObjectURL(processedImageUrl);
    }
    
    stopProcessingTimer();
});

async function initializeApp() {
    console.log('üîß Initializing SnapCut...');
    
    aiProgressIndicator.style.display = 'block';
    aiProgressStage.classList.add('active');
    
    if (typeof window.bgRemoval !== 'undefined') {
        try {
            const status = await window.bgRemoval.testConnection();
            console.log('Model status:', status);
            
            aiProgressMessage.textContent = `AI model siap ‚Ä¢ ${status.modelSize || '213 MB'}`;
            aiProgressStatus.innerHTML = `
                <div class="ai-progress-dot" style="background: #22c55e"></div>
                <span>AI model ready ‚Ä¢ ${status.mode || 'CPU Mode'}</span>
            `;
            
            showNotification(`‚úÖ AI model siap ‚Ä¢ ${status.mode || 'CPU Mode'}`, 'success', 4000);

        } catch (error) {
            console.error('Error checking model:', error);
            aiProgressMessage.textContent = 'Model siap, tapi ada warning saat check status';
            aiProgressStatus.innerHTML = `
                <div class="ai-progress-dot" style="background: #f59e0b"></div>
                <span>AI model warning</span>
            `;
            
            showNotification('‚ö†Ô∏è Model siap, tapi ada warning saat check status', 'info', 4000);
        }

    } else {
        aiProgressMessage.textContent = 'Background Removal API tidak tersedia';
        aiProgressStatus.innerHTML = `
            <div class="ai-progress-dot" style="background: #ef4444"></div>
            <span>API Error</span>
        `;
        showNotification('‚ùå Background Removal API tidak tersedia', 'error');
    }
}

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
        showSplashScreen();
        setTimeout(initializeApp, 1500);
    });
} else {
    showSplashScreen();
    setTimeout(initializeApp, 1500);
}
</script>
</body>
</html>
